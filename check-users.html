<!DOCTYPE html>
<html>
<head>
    <title>Firebase Users Query</title>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
        import { getFirestore, collection, getDocs } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

        // WARNING: This file contains exposed Firebase configuration
        // For security, this should load from environment variables or be removed
        // This is a development utility that should not be deployed to production
        
        const firebaseConfig = {
            apiKey: "[REMOVED_FOR_SECURITY]",
            authDomain: "[REMOVED_FOR_SECURITY]",
            projectId: "[REMOVED_FOR_SECURITY]", 
            storageBucket: "[REMOVED_FOR_SECURITY]",
            messagingSenderId: "[REMOVED_FOR_SECURITY]",
            appId: "[REMOVED_FOR_SECURITY]",
            measurementId: "[REMOVED_FOR_SECURITY]"
        };
        
        // Display security warning
        document.addEventListener('DOMContentLoaded', function() {
            const warningDiv = document.createElement('div');
            warningDiv.style.backgroundColor = '#ffeb3b';
            warningDiv.style.border = '2px solid #ff9800';
            warningDiv.style.padding = '15px';
            warningDiv.style.margin = '10px 0';
            warningDiv.innerHTML = '<strong>⚠️ SECURITY WARNING:</strong> Firebase credentials have been removed for security. Configure environment variables to use this tool.';
            document.body.insertBefore(warningDiv, document.body.firstChild);
        });

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function queryUsers() {
            try {
                // Check if configuration is valid
                if (firebaseConfig.apiKey === '[REMOVED_FOR_SECURITY]') {
                    throw new Error('Firebase configuration not available. Please configure environment variables.');
                }
                
                console.log('Querying users collection...');
                const usersCollection = collection(db, 'users');
                const snapshot = await getDocs(usersCollection);
                
                const resultDiv = document.getElementById('result');
                resultDiv.innerHTML = `<h2>Found ${snapshot.size} users:</h2>`;
                
                if (snapshot.size === 0) {
                    resultDiv.innerHTML += '<p>No users found in the database.</p>';
                    return;
                }
                
                snapshot.forEach((doc) => {
                    const data = doc.data();
                    const userDiv = document.createElement('div');
                    userDiv.style.border = '1px solid #ccc';
                    userDiv.style.margin = '10px 0';
                    userDiv.style.padding = '10px';
                    userDiv.innerHTML = `
                        <strong>Firebase UID:</strong> ${doc.id}<br>
                        <strong>User ID:</strong> ${data.id}<br>
                        <strong>Username:</strong> ${data.username}<br>
                        <strong>Language:</strong> ${data.language}<br>
                        <strong>Online:</strong> ${data.isOnline}<br>
                        <strong>Last Seen:</strong> ${data.lastSeen?.toDate ? data.lastSeen.toDate() : data.lastSeen}<br>
                    `;
                    resultDiv.appendChild(userDiv);
                });
            } catch (error) {
                console.error('Error querying users:', error);
                document.getElementById('result').innerHTML = `<p>Error: ${error.message}</p>`;
            }
        }

        window.queryUsers = queryUsers;
    </script>
</head>
<body>
    <h1>Firebase Users Query</h1>
    <button onclick="queryUsers()">Query Users</button>
    <div id="result"></div>
</body>
</html>